# =============================================================================
# NoteNest - Docker Compose für Synology NAS
# =============================================================================
# Dieses Beispiel zeigt die Konfiguration für eine Synology NAS
# mit mehreren Shared-Ordnern
# =============================================================================

services:
  notenest:
    # Image (entweder lokal gebaut oder von Registry)
    image: notenest:latest
    # Oder bauen:
    # build:
    #   context: .
    #   dockerfile: Dockerfile
    
    container_name: notenest
    restart: unless-stopped
    
    # Port (passe an freien Port auf deiner NAS an)
    ports:
      - "3100:3000"
    
    # =============================================================================
    # VOLUMES - WICHTIG: Hier werden NAS-Ordner in den Container gemountet
    # =============================================================================
    volumes:
      # --- Datenbank (persistent, lokal auf NAS) ---
      - ./data/database:/data/database
      
      # --- Home-Verzeichnisse (Private Ordner) ---
      # Synology: /volume1/homes wird zu /data/homes im Container
      # :ro = read-only (Sicherheit - NoteNest liest nur, schreibt aber trotzdem via User-Permissions)
      - /volume1/homes:/data/homes:ro
      
      # --- Shared-Ordner (Mehrere Ordner möglich!) ---
      # Diese werden alle unter /data/shared/* gemountet
      
      # Hauptordner (alle sehen diesen)
      - /volume1/shared:/data/shared/Allgemein:rw
      
      # Familie-Ordner (nur Familie hat Zugriff via NAS-Permissions)
      - /volume1/Familie:/data/shared/Familie:rw
      
      # Projekte-Ordner (projektspezifisch)
      - /volume1/Projekte:/data/shared/Projekte:rw
      
      # Arbeit-Ordner (nur Work-Team via NAS-Permissions)
      - /volume1/Arbeit:/data/shared/Arbeit:rw
      
      # Weitere Ordner nach Bedarf...
      # - /volume1/DeinOrdner:/data/shared/DeinOrdner:rw
      
      # --- Logs ---
      - ./logs:/app/logs
      
      # --- Bibel-Daten (optional) ---
      - ./data/bibles:/app/data/bibles:ro
      
      # --- .env Datei ---
      - ./.env:/app/.env
    
    # =============================================================================
    # ENVIRONMENT VARIABLES
    # =============================================================================
    environment:
      - NODE_ENV=production
      - LOG_DIR=/app/logs
    
    env_file:
      - .env
    
    # =============================================================================
    # USER - WICHTIG für NAS-Permissions!
    # =============================================================================
    # Synology Standard: admin = UID 1024, users = GID 100
    # Prüfe mit: id admin (auf der NAS via SSH)
    # Falls andere UID/GID: Hier anpassen
    user: "1024:100"
    
    # =============================================================================
    # NETWORK & HEALTH
    # =============================================================================
    networks:
      - notenest-network
    
    healthcheck:
      test: ["CMD-SHELL", "wget --no-verbose --tries=1 --spider http://localhost:3000/api/health || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  notenest-network:
    driver: bridge

